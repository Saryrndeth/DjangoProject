{% extends 'base.html' %}
{% block content %}
    <div class="container">
        <div class="side-bar" style="position: absolute; float: right; right: 80px; width: 250px; top: 70px;">
            <div class="user-actions">
                {% if not user.is_authenticated %}
                    <a href="{% url 'login:login' %}">로그인</a>
                    <a href="{% url 'login:signup' %}">회원가입</a>
                {% else %}
                    <a href="{% url 'login:logout' %}" class="user-info">{{ user.nickname }}({{ user.School }})<br>(로그아웃)</a>
                {% endif %}
            </div>
            <div class="info-table">
                <table>
                    <tr>
                        <th class="school">로딩중...</th>
                    </tr>
                    <tr>
                        <th class="date">로딩중...</th>
                    </tr>
                    <tr>
                        <th class="menu">로딩중...</th>
                    </tr>
                </table>
            </div>
            <div class="schedule-table" style="position: absolute; ">
                <table style="width: 200px">
                    <tr>
                        <th class="notion">로딩중...</th>
                    </tr>
                    <tr>
                        <th class="schedule">로딩중...</th>
                    </tr>
                </table>
            </div>
        </div>

        <div><a class="question_write" href="{% url 'pyms:question_write' %}" style="position: absolute;width: 8%; top: 45px; font-size: 80%; padding: 5px;">질문 등록하기</a></div>
        <div class="main-content" style="position: absolute;top: 100px; padding: 0%;">
            {% if question_list %}
                <table style="width: 75%;">
                    <colgroup>
                        <col style="width:10%">
                        <col style="width:50%">
                        <col style="width:10%">
                        <col style="width:15%">
                        <col style="width:15%">
                    </colgroup>
                    <tr>
                        <th style="border:none;">번호</th>
                        <th style="border:none;">제목</th>
                        <th style="border:none;">작성자</th>
                        <th style="border:none;">작성일</th>
                        <th style="border:none;">학교</th>
                    </tr>
                    {% for question in question_list %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td><a href="{% url 'pyms:question_detail' question.id %}">{{ question.subject }}</a></td>
                            <td>{{ question.nickname }}</td>
                            <td>{{ question.create_date }}</td>
                            <td>{{ question.user.School}}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>질문이 없습니다.</p>
            {% endif %}
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $.ajax({
                type: "POST",
                url: "{% url 'pyms:ajax_menu' %}",
                data: {
                    'school': '{{ user.School }}',
                    'grade': '{{ user.Grade }}',
                    'cls': '{{ user.Class }}'
                },
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                success: function(response) {

                    console.log(response.schedule);
                    {% if user.is_authenticated %}
                        $('.notion').html("{{ user.Grade }}학년 {{ user.Class }}반 시간표");
                        $('.schedule').html(response.schedule.join('<br>'));

                        $('.school').text(response.school);
                        $('.date').text(response.date);
                        $('.menu').html(response.menu.join('<br>'));
                    {% else %}
                        $('.school').html('로그인해주세요!');
                        $('.date').html('');
                        $('.menu').html('');
                        $('.schedule').html('');
                        $('.notion').html('');
                    {% endif %}
                }
            });
        });
    </script>
    <style>
        table, tr, td{
            border:none;
        }
    </style>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
{% endblock %}
